---
title: "Baseline Estimate"
author: "Martin Roth"
date: "April 11, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Get training set and corresponding image feature data from DB

We want to have a baseline estimate to compare the Neural Network approach of
Daniel.

```{r Libraries}
library(data.table)
library(DBI)
library(jsonlite)
```

```{r OpenDB}
dbConfig <- fromJSON("../config.json")

con <- dbConnect(RPostgreSQL::PostgreSQL(),
                 dbname = "FOGDB",
                 host = dbConfig[["host"]], port = 22022,
                 user = dbConfig[["user"]], password = dbConfig[["pw"]])

```

```{r ObtainTraininSet}
train <- readRDS("~/Desktop/Daniel/Training/ImageDescription.rds")
```

```{r GetFeatureData}
selectedFeatures <- c("mean_edge", "change_point", "fractal_dim",
                      "mean_hue", "mean_saturation", "mean_brightness")
sqlSelect <- "SELECT image_id, "
sqlSelect <- paste0(sqlSelect, paste(selectedFeatures, collapse = ", "))
sqlSelect <- paste0(sqlSelect, " FROM image_features WHERE image_id IN ")
sqlSelect <- paste0(sqlSelect,
                    "(", paste(train[, image_id], collapse = ", "),
                    ")")

features <- as.data.table(dbGetQuery(con, sqlSelect))
```

```{r MergeTrainingWithFeatures}
train <- merge(train, features, by = "image_id")
head(train)
```


```{r CloseDB}
dbDisconnect(con)
```


